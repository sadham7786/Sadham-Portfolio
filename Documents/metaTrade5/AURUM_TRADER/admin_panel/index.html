<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>AURUM TRADER â€” Admin Console</title>
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@300;400;500;600;700;900&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet" />
<style>
/* â”€â”€ Reset & Variables â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --bg:        #09090c;
  --bg2:       #0f1016;
  --bg3:       #14151e;
  --bg4:       #1a1c28;
  --border:    #1e2232;
  --border2:   #252838;
  --gold:      #d4a843;
  --gold-dim:  rgba(212,168,67,0.12);
  --gold-glow: rgba(212,168,67,0.25);
  --green:     #1fcc74;
  --green-dim: rgba(31,204,116,0.12);
  --red:       #f0454a;
  --red-dim:   rgba(240,69,74,0.12);
  --blue:      #3b7ef8;
  --blue-dim:  rgba(59,126,248,0.12);
  --text:      #c8cdd8;
  --text-dim:  #5a6070;
  --text-mid:  #8892a0;
  --radius:    4px;
  --font-main: 'Barlow Condensed', sans-serif;
  --font-mono: 'Space Mono', monospace;
}

html { font-size: 14px; }
body {
  background: var(--bg);
  color: var(--text);
  font-family: var(--font-main);
  min-height: 100vh;
  overflow-x: hidden;
}

/* â”€â”€ Scrollbar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
::-webkit-scrollbar { width: 4px; height: 4px; }
::-webkit-scrollbar-track { background: var(--bg2); }
::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 2px; }

/* â”€â”€ Login Screen â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#login-screen {
  position: fixed; inset: 0; z-index: 1000;
  display: flex; align-items: center; justify-content: center;
  background: var(--bg);
}
#login-screen::before {
  content: '';
  position: absolute; top: -120px; left: -80px;
  width: 500px; height: 500px; border-radius: 50%;
  background: radial-gradient(circle, rgba(212,168,67,0.08) 0%, transparent 70%);
  pointer-events: none;
}
.login-box {
  width: 100%; max-width: 400px;
  padding: 0 24px;
  animation: fadeUp 0.6s ease both;
}
.login-logo {
  display: flex; align-items: center; gap: 12px;
  justify-content: center; margin-bottom: 32px;
}
.login-logo .box {
  width: 48px; height: 48px;
  border: 1.5px solid var(--gold);
  background: var(--gold-dim);
  display: flex; align-items: center; justify-content: center;
  font-family: var(--font-mono); color: var(--gold); font-size: 12px; font-weight: 700;
  box-shadow: 0 0 24px var(--gold-glow);
}
.login-logo .title-wrap { display: flex; flex-direction: column; }
.login-logo .title { font-size: 22px; font-weight: 900; letter-spacing: 3px; color: #fff; }
.login-logo .sub { font-size: 11px; letter-spacing: 2.5px; color: var(--gold); }

.login-card {
  background: var(--bg2);
  border: 1px solid var(--border);
  border-top: 1.5px solid var(--gold);
  padding: 32px;
}
.login-card h2 {
  font-size: 22px; font-weight: 900; letter-spacing: 3px;
  color: var(--text); margin-bottom: 4px;
}
.login-card p { color: var(--text-dim); font-size: 13px; margin-bottom: 24px; }

.form-group { margin-bottom: 16px; }
.form-group label {
  display: block; font-size: 10px; letter-spacing: 2px;
  color: var(--text-dim); margin-bottom: 8px; text-transform: uppercase;
}
.form-group input {
  width: 100%; background: var(--bg3);
  border: 1px solid var(--border); border-radius: var(--radius);
  padding: 11px 14px; color: var(--text);
  font-family: var(--font-main); font-size: 15px;
  outline: none; transition: border-color 0.2s;
}
.form-group input:focus { border-color: var(--gold); }
.form-group input::placeholder { color: var(--text-dim); }

.btn-gold {
  width: 100%; padding: 13px;
  background: var(--gold); color: #0a0a0c;
  border: none; border-radius: var(--radius);
  font-family: var(--font-main); font-size: 15px; font-weight: 700;
  letter-spacing: 2px; text-transform: uppercase;
  cursor: pointer; transition: opacity 0.2s, transform 0.1s;
}
.btn-gold:hover { opacity: 0.9; }
.btn-gold:active { transform: scale(0.99); }
.btn-gold:disabled { opacity: 0.5; cursor: not-allowed; }

#login-error {
  margin-top: 12px; padding: 10px 12px;
  background: var(--red-dim); border: 1px solid rgba(240,69,74,0.3);
  border-radius: var(--radius); color: var(--red); font-size: 13px;
  display: none;
}

/* â”€â”€ App Shell â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#app { display: none; flex-direction: column; min-height: 100vh; }

/* â”€â”€ Top Bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#topbar {
  height: 52px; background: var(--bg2);
  border-bottom: 1px solid var(--border);
  display: flex; align-items: center;
  padding: 0 20px; gap: 16px;
  position: sticky; top: 0; z-index: 100;
  flex-shrink: 0;
}
.topbar-logo { display: flex; align-items: center; gap: 10px; }
.topbar-logo .box {
  width: 28px; height: 28px;
  border: 1px solid var(--gold); background: var(--gold-dim);
  display: flex; align-items: center; justify-content: center;
  font-family: var(--font-mono); color: var(--gold); font-size: 8px; font-weight: 700;
}
.topbar-logo span { font-size: 15px; font-weight: 900; letter-spacing: 3px; color: #fff; }
.topbar-logo small { font-size: 9px; letter-spacing: 2px; color: var(--gold); }

#live-price {
  margin-left: auto; display: flex; align-items: center; gap: 16px;
}
.price-chip {
  display: flex; flex-direction: column; align-items: flex-end;
}
.price-chip .label { font-size: 9px; letter-spacing: 1.5px; color: var(--text-dim); }
.price-chip .val {
  font-family: var(--font-mono); font-size: 14px; font-weight: 700;
  transition: color 0.3s;
}
.price-chip .val.up { color: var(--green); }
.price-chip .val.down { color: var(--red); }
.price-chip .val.neutral { color: var(--text); }

.topbar-sep { width: 1px; height: 28px; background: var(--border); }

#conn-dot {
  width: 8px; height: 8px; border-radius: 50%;
  background: var(--text-dim);
  animation: pulse 1.5s ease-in-out infinite;
}
#conn-dot.connected { background: var(--green); animation: none; }
#conn-dot.error { background: var(--red); animation: none; }

.topbar-admin {
  display: flex; align-items: center; gap: 8px;
  font-size: 12px; color: var(--text-dim);
}
.topbar-admin strong { color: var(--gold); font-size: 11px; letter-spacing: 1px; }

.btn-logout {
  padding: 6px 14px; background: transparent;
  border: 1px solid var(--border); border-radius: var(--radius);
  color: var(--text-dim); font-family: var(--font-main);
  font-size: 11px; letter-spacing: 1px; cursor: pointer;
  text-transform: uppercase; transition: all 0.2s;
}
.btn-logout:hover { border-color: var(--red); color: var(--red); }

/* â”€â”€ Layout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#layout { display: flex; flex: 1; }

/* â”€â”€ Sidebar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#sidebar {
  width: 200px; background: var(--bg2);
  border-right: 1px solid var(--border);
  display: flex; flex-direction: column;
  flex-shrink: 0; padding: 16px 0;
}
.nav-section {
  padding: 0 12px; margin-bottom: 8px;
}
.nav-label {
  font-size: 9px; letter-spacing: 2px; color: var(--text-dim);
  padding: 8px 8px 6px; text-transform: uppercase;
}
.nav-item {
  display: flex; align-items: center; gap: 10px;
  padding: 9px 10px; border-radius: var(--radius);
  cursor: pointer; transition: all 0.15s;
  font-size: 13px; font-weight: 600; letter-spacing: 0.5px;
  color: var(--text-dim); user-select: none;
  border: 1px solid transparent;
}
.nav-item:hover { background: var(--bg3); color: var(--text); }
.nav-item.active {
  background: var(--gold-dim); color: var(--gold);
  border-color: rgba(212,168,67,0.2);
}
.nav-item svg { width: 15px; height: 15px; flex-shrink: 0; }
.nav-badge {
  margin-left: auto; background: var(--gold); color: #0a0a0c;
  font-size: 10px; font-weight: 700; padding: 1px 6px; border-radius: 10px;
  min-width: 20px; text-align: center;
}

/* â”€â”€ Main Content â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#content { flex: 1; overflow: auto; }
.page { display: none; padding: 24px; }
.page.active { display: block; animation: fadeIn 0.2s ease; }

/* â”€â”€ Page Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.page-header {
  display: flex; align-items: center; justify-content: space-between;
  margin-bottom: 24px;
}
.page-title { font-size: 22px; font-weight: 900; letter-spacing: 2px; }
.page-sub { font-size: 12px; color: var(--text-dim); margin-top: 2px; }

/* â”€â”€ Stats Grid â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.stats-grid {
  display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 12px; margin-bottom: 24px;
}
.stat-card {
  background: var(--bg2); border: 1px solid var(--border);
  border-radius: var(--radius); padding: 16px 18px;
  position: relative; overflow: hidden;
  transition: border-color 0.2s;
}
.stat-card::before {
  content: ''; position: absolute; top: 0; left: 0; right: 0;
  height: 2px; background: var(--gold); opacity: 0;
  transition: opacity 0.2s;
}
.stat-card:hover { border-color: var(--border2); }
.stat-card:hover::before { opacity: 1; }
.stat-card .label {
  font-size: 9px; letter-spacing: 2px; color: var(--text-dim);
  text-transform: uppercase; margin-bottom: 8px;
}
.stat-card .value {
  font-family: var(--font-mono); font-size: 22px; font-weight: 700;
  line-height: 1;
}
.stat-card .sub {
  font-size: 11px; color: var(--text-dim); margin-top: 4px;
}
.stat-card.gold .value { color: var(--gold); }
.stat-card.green .value { color: var(--green); }
.stat-card.red .value { color: var(--red); }
.stat-card.blue .value { color: var(--blue); }
.stat-icon {
  position: absolute; right: 14px; top: 14px;
  opacity: 0.08; font-size: 32px; line-height: 1;
}

/* â”€â”€ Card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.card {
  background: var(--bg2); border: 1px solid var(--border);
  border-radius: var(--radius); margin-bottom: 20px;
}
.card-header {
  display: flex; align-items: center; justify-content: space-between;
  padding: 14px 18px; border-bottom: 1px solid var(--border);
}
.card-title { font-size: 13px; font-weight: 700; letter-spacing: 1.5px; text-transform: uppercase; }
.card-body { padding: 18px; }

/* â”€â”€ Table â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.table-wrap { overflow-x: auto; }
table { width: 100%; border-collapse: collapse; font-size: 13px; }
thead th {
  padding: 10px 12px; text-align: left;
  font-size: 9px; letter-spacing: 2px; text-transform: uppercase;
  color: var(--text-dim); border-bottom: 1px solid var(--border);
  white-space: nowrap; cursor: pointer; user-select: none;
  background: var(--bg3);
}
thead th:hover { color: var(--gold); }
thead th.sorted { color: var(--gold); }
tbody tr {
  border-bottom: 1px solid var(--border);
  transition: background 0.1s;
}
tbody tr:last-child { border-bottom: none; }
tbody tr:hover { background: var(--bg3); }
tbody td { padding: 11px 12px; color: var(--text); }
tbody td.mono { font-family: var(--font-mono); font-size: 12px; }
.td-right { text-align: right; }
.td-center { text-align: center; }

/* â”€â”€ Badges â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.badge {
  display: inline-block; padding: 2px 8px; border-radius: 2px;
  font-size: 10px; font-weight: 700; letter-spacing: 1px;
  text-transform: uppercase;
}
.badge-green { background: var(--green-dim); color: var(--green); border: 1px solid rgba(31,204,116,0.25); }
.badge-red { background: var(--red-dim); color: var(--red); border: 1px solid rgba(240,69,74,0.25); }
.badge-gold { background: var(--gold-dim); color: var(--gold); border: 1px solid rgba(212,168,67,0.25); }
.badge-blue { background: var(--blue-dim); color: var(--blue); border: 1px solid rgba(59,126,248,0.25); }
.badge-gray { background: var(--bg4); color: var(--text-dim); border: 1px solid var(--border); }

/* â”€â”€ Positive/Negative Values â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.pos { color: var(--green); }
.neg { color: var(--red); }
.neu { color: var(--text); }

/* â”€â”€ Buttons â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.btn {
  padding: 7px 14px; border-radius: var(--radius);
  font-family: var(--font-main); font-size: 11px; font-weight: 700;
  letter-spacing: 1px; text-transform: uppercase; cursor: pointer;
  border: 1px solid; transition: all 0.15s; white-space: nowrap;
}
.btn-sm { padding: 4px 10px; font-size: 10px; }
.btn-outline-gold {
  background: transparent; border-color: var(--gold); color: var(--gold);
}
.btn-outline-gold:hover { background: var(--gold-dim); }
.btn-outline-red {
  background: transparent; border-color: var(--red); color: var(--red);
}
.btn-outline-red:hover { background: var(--red-dim); }
.btn-outline-blue {
  background: transparent; border-color: var(--blue); color: var(--blue);
}
.btn-outline-blue:hover { background: var(--blue-dim); }
.btn-outline-gray {
  background: transparent; border-color: var(--border); color: var(--text-dim);
}
.btn-outline-gray:hover { border-color: var(--border2); color: var(--text); }

/* â”€â”€ Search / Filter Bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.toolbar {
  display: flex; align-items: center; gap: 10px;
  margin-bottom: 16px; flex-wrap: wrap;
}
.search-input {
  flex: 1; min-width: 200px;
  background: var(--bg3); border: 1px solid var(--border);
  border-radius: var(--radius); padding: 9px 14px;
  color: var(--text); font-family: var(--font-main); font-size: 14px;
  outline: none; transition: border-color 0.2s;
}
.search-input:focus { border-color: var(--gold); }
.search-input::placeholder { color: var(--text-dim); }
select.filter-select {
  background: var(--bg3); border: 1px solid var(--border);
  border-radius: var(--radius); padding: 9px 14px;
  color: var(--text); font-family: var(--font-main); font-size: 14px;
  outline: none; cursor: pointer;
}
select.filter-select:focus { border-color: var(--gold); }

/* â”€â”€ Pagination â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.pagination {
  display: flex; align-items: center; gap: 8px;
  padding: 12px 18px; border-top: 1px solid var(--border);
  justify-content: flex-end; font-size: 12px;
}
.pagination .info { color: var(--text-dim); margin-right: auto; }
.pg-btn {
  padding: 5px 12px; background: var(--bg3);
  border: 1px solid var(--border); border-radius: var(--radius);
  color: var(--text-dim); cursor: pointer; font-family: var(--font-main);
  font-size: 11px; letter-spacing: 1px; transition: all 0.15s;
}
.pg-btn:hover:not(:disabled) { border-color: var(--gold); color: var(--gold); }
.pg-btn:disabled { opacity: 0.4; cursor: not-allowed; }
.pg-btn.active { background: var(--gold-dim); border-color: var(--gold); color: var(--gold); }

/* â”€â”€ Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.modal-backdrop {
  position: fixed; inset: 0; z-index: 500;
  background: rgba(0,0,0,0.7);
  display: flex; align-items: center; justify-content: center;
  padding: 20px;
  animation: fadeIn 0.15s ease;
}
.modal {
  background: var(--bg2); border: 1px solid var(--border);
  border-top: 2px solid var(--gold); border-radius: var(--radius);
  width: 100%; max-width: 680px; max-height: 90vh;
  display: flex; flex-direction: column;
  animation: fadeUp 0.2s ease;
}
.modal-header {
  padding: 18px 22px; border-bottom: 1px solid var(--border);
  display: flex; align-items: center; justify-content: space-between;
}
.modal-title { font-size: 16px; font-weight: 900; letter-spacing: 2px; text-transform: uppercase; }
.modal-close {
  width: 28px; height: 28px; border: 1px solid var(--border);
  border-radius: var(--radius); background: transparent;
  color: var(--text-dim); cursor: pointer; font-size: 16px;
  display: flex; align-items: center; justify-content: center;
  transition: all 0.15s;
}
.modal-close:hover { border-color: var(--red); color: var(--red); }
.modal-body { padding: 22px; overflow-y: auto; flex: 1; }

/* â”€â”€ User Detail inside Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.user-meta {
  display: flex; align-items: center; gap: 16px;
  margin-bottom: 20px;
}
.user-avatar {
  width: 54px; height: 54px; border-radius: var(--radius);
  background: linear-gradient(135deg, var(--gold-dim) 0%, rgba(212,168,67,0.2) 100%);
  border: 1px solid rgba(212,168,67,0.3);
  display: flex; align-items: center; justify-content: center;
  font-size: 22px; font-weight: 900; color: var(--gold);
  flex-shrink: 0;
}
.user-info .name { font-size: 18px; font-weight: 900; letter-spacing: 1px; }
.user-info .email { font-size: 12px; color: var(--text-dim); margin-top: 2px; }
.user-info .joined { font-size: 11px; color: var(--text-dim); margin-top: 4px; }

.user-stats-grid {
  display: grid; grid-template-columns: repeat(3, 1fr);
  gap: 10px; margin-bottom: 20px;
}
.user-stat {
  background: var(--bg3); border: 1px solid var(--border);
  border-radius: var(--radius); padding: 12px 14px;
}
.user-stat .label { font-size: 9px; letter-spacing: 1.5px; color: var(--text-dim); margin-bottom: 5px; }
.user-stat .val { font-family: var(--font-mono); font-size: 15px; font-weight: 700; }

.modal-section-title {
  font-size: 10px; letter-spacing: 2px; color: var(--text-dim);
  text-transform: uppercase; margin: 16px 0 10px;
  padding-bottom: 6px; border-bottom: 1px solid var(--border);
}

.balance-edit {
  display: flex; align-items: center; gap: 10px; margin-bottom: 16px;
}
.balance-edit input {
  flex: 1; background: var(--bg3); border: 1px solid var(--border);
  border-radius: var(--radius); padding: 9px 14px;
  color: var(--text); font-family: var(--font-mono); font-size: 15px;
  outline: none; transition: border-color 0.2s;
}
.balance-edit input:focus { border-color: var(--gold); }

/* â”€â”€ XAU Price Banner â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#price-banner {
  display: flex; align-items: center; gap: 20px;
  background: var(--bg2); border: 1px solid var(--border);
  border-radius: var(--radius); padding: 12px 18px;
  margin-bottom: 24px; flex-wrap: wrap;
}
.price-item { display: flex; flex-direction: column; }
.price-item .lbl { font-size: 9px; letter-spacing: 1.5px; color: var(--text-dim); }
.price-item .vl { font-family: var(--font-mono); font-size: 14px; font-weight: 700; }
#main-bid { font-size: 24px !important; }

/* â”€â”€ Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#toast-container {
  position: fixed; bottom: 24px; right: 24px; z-index: 9999;
  display: flex; flex-direction: column; gap: 8px;
}
.toast {
  background: var(--bg3); border: 1px solid var(--border);
  border-left: 3px solid var(--gold);
  padding: 12px 16px; border-radius: var(--radius);
  font-size: 13px; min-width: 240px; max-width: 360px;
  animation: slideIn 0.25s ease, fadeOut 0.3s ease 2.7s both;
  box-shadow: 0 8px 24px rgba(0,0,0,0.5);
}
.toast.success { border-left-color: var(--green); }
.toast.error { border-left-color: var(--red); }

/* â”€â”€ Loading â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.loader {
  display: flex; align-items: center; justify-content: center;
  padding: 48px; color: var(--text-dim); gap: 12px;
  font-size: 13px; letter-spacing: 1px;
}
.spinner {
  width: 20px; height: 20px;
  border: 2px solid var(--border);
  border-top-color: var(--gold); border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

/* â”€â”€ Empty State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.empty {
  padding: 48px; text-align: center;
  color: var(--text-dim); font-size: 13px; letter-spacing: 1px;
}
.empty .icon { font-size: 36px; margin-bottom: 12px; opacity: 0.4; }

/* â”€â”€ Inline Metrics Row â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.metrics-row {
  display: flex; gap: 8px; flex-wrap: wrap; align-items: center;
}

/* â”€â”€ Win Rate Bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.wr-bar {
  display: flex; height: 4px; border-radius: 2px;
  overflow: hidden; background: var(--bg4); width: 60px; margin-top: 3px;
}
.wr-fill { background: var(--green); border-radius: 2px; }

/* â”€â”€ Responsive â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@media (max-width: 768px) {
  #sidebar { display: none; }
  .stats-grid { grid-template-columns: repeat(2, 1fr); }
  .user-stats-grid { grid-template-columns: repeat(2, 1fr); }
}

/* â”€â”€ Keyframes â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
@keyframes fadeUp { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }
@keyframes slideIn { from { opacity: 0; transform: translateX(20px); } to { opacity: 1; transform: translateX(0); } }
@keyframes fadeOut { to { opacity: 0; transform: translateX(10px); } }
@keyframes spin { to { transform: rotate(360deg); } }
@keyframes pulse { 0%,100% { opacity: 1; } 50% { opacity: 0.3; } }
</style>
</head>
<body>

<!-- â•â• LOGIN â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="login-screen">
  <div class="login-box">
    <div class="login-logo">
      <div class="box">AT</div>
      <div class="title-wrap">
        <span class="title">AURUM TRADER</span>
        <span class="sub">ADMIN CONSOLE</span>
      </div>
    </div>
    <div class="login-card">
      <h2>ADMIN LOGIN</h2>
      <p>Enter your admin credentials to access the control panel</p>
      <div class="form-group">
        <label>Admin Password</label>
        <input type="password" id="admin-pass" placeholder="Enter admin password" />
      </div>
      <button class="btn-gold" id="login-btn" onclick="doLogin()">ACCESS PANEL</button>
      <div id="login-error"></div>
    </div>
  </div>
</div>

<!-- â•â• APP â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="app">
  <!-- Top Bar -->
  <div id="topbar">
    <div class="topbar-logo">
      <div class="box">AT</div>
      <div>
        <span>AURUM TRADER</span>
        <small style="display:block;margin-top:-2px">ADMIN CONSOLE</small>
      </div>
    </div>
    <div class="topbar-sep"></div>
    <div id="live-price">
      <div class="price-chip">
        <span class="label">BID</span>
        <span class="val neutral" id="tb-bid">â€”</span>
      </div>
      <div class="price-chip">
        <span class="label">ASK</span>
        <span class="val neutral" id="tb-ask">â€”</span>
      </div>
      <div class="price-chip">
        <span class="label">CHG%</span>
        <span class="val neutral" id="tb-chg">â€”</span>
      </div>
    </div>
    <div class="topbar-sep"></div>
    <div id="conn-dot"></div>
    <div class="topbar-sep"></div>
    <div class="topbar-admin">
      <strong>ADMIN</strong>
    </div>
    <button class="btn-logout" onclick="logout()">LOGOUT</button>
  </div>

  <!-- Layout -->
  <div id="layout">
    <!-- Sidebar -->
    <div id="sidebar">
      <div class="nav-section">
        <div class="nav-label">Overview</div>
        <div class="nav-item active" onclick="showPage('dashboard')" data-page="dashboard">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
          Dashboard
        </div>
      </div>
      <div class="nav-section">
        <div class="nav-label">Management</div>
        <div class="nav-item" onclick="showPage('users')" data-page="users">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
          Users
          <span class="nav-badge" id="users-badge">0</span>
        </div>
        <div class="nav-item" onclick="showPage('trades')" data-page="trades">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>
          All Trades
          <span class="nav-badge" id="trades-badge" style="background:var(--green);color:#000">0</span>
        </div>
      </div>
      <div class="nav-section">
        <div class="nav-label">Market</div>
        <div class="nav-item" onclick="showPage('market')" data-page="market">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 8 11 13 6 21 14"/><line x1="21" y1="14" x2="21" y2="20"/><line x1="3" y1="20" x2="21" y2="20"/></svg>
          XAU/USD Live
        </div>
      </div>
    </div>

    <!-- Content -->
    <div id="content">

      <!-- â”€â”€ DASHBOARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
      <div id="page-dashboard" class="page active">
        <div class="page-header">
          <div>
            <div class="page-title">DASHBOARD</div>
            <div class="page-sub">Platform overview Â· Auto-refresh every 10s</div>
          </div>
          <button class="btn btn-outline-gold" onclick="loadDashboard()">â†» REFRESH</button>
        </div>

        <div id="price-banner">
          <div class="price-item">
            <span class="lbl">XAU/USD BID</span>
            <span class="vl" id="main-bid" style="font-size:24px">â€”</span>
          </div>
          <div class="price-item">
            <span class="lbl">ASK</span>
            <span class="vl" id="main-ask">â€”</span>
          </div>
          <div class="price-item">
            <span class="lbl">SPREAD</span>
            <span class="vl" id="main-spread">â€”</span>
          </div>
          <div class="price-item">
            <span class="lbl">24H HIGH</span>
            <span class="vl" id="main-high" style="color:var(--green)">â€”</span>
          </div>
          <div class="price-item">
            <span class="lbl">24H LOW</span>
            <span class="vl" id="main-low" style="color:var(--red)">â€”</span>
          </div>
          <div class="price-item">
            <span class="lbl">CHANGE</span>
            <span class="vl" id="main-chg">â€”</span>
          </div>
          <div style="margin-left:auto;font-size:10px;color:var(--text-dim);font-family:var(--font-mono)" id="price-ts"></div>
        </div>

        <div class="stats-grid" id="dash-stats">
          <div class="loader"><div class="spinner"></div> Loading...</div>
        </div>

        <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px" class="dash-bottom">
          <!-- Recent Users -->
          <div class="card">
            <div class="card-header">
              <span class="card-title">Recent Registrations</span>
              <button class="btn btn-sm btn-outline-gray" onclick="showPage('users')">VIEW ALL</button>
            </div>
            <div id="recent-users"><div class="loader"><div class="spinner"></div></div></div>
          </div>
          <!-- Platform Activity -->
          <div class="card">
            <div class="card-header">
              <span class="card-title">Open Positions</span>
              <button class="btn btn-sm btn-outline-gray" onclick="showPage('trades')">VIEW ALL</button>
            </div>
            <div id="dash-open-trades"><div class="loader"><div class="spinner"></div></div></div>
          </div>
        </div>
      </div>

      <!-- â”€â”€ USERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
      <div id="page-users" class="page">
        <div class="page-header">
          <div>
            <div class="page-title">USERS</div>
            <div class="page-sub" id="users-sub">All registered accounts</div>
          </div>
          <button class="btn btn-outline-gold" onclick="loadUsers(usersPage)">â†» REFRESH</button>
        </div>

        <div class="toolbar">
          <input class="search-input" type="text" id="user-search" placeholder="Search by name or emailâ€¦" oninput="onUserSearch()" />
          <select class="filter-select" id="user-sort" onchange="loadUsers(1)">
            <option value="createdAt">Sort: Newest</option>
            <option value="balance">Sort: Balance</option>
            <option value="totalTrades">Sort: Trades</option>
            <option value="fullName">Sort: Name A-Z</option>
          </select>
        </div>

        <div class="card">
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th onclick="sortUsers('fullName')">USER</th>
                  <th onclick="sortUsers('balance')">BALANCE</th>
                  <th onclick="sortUsers('equity')">EQUITY</th>
                  <th>LIVE P&L</th>
                  <th onclick="sortUsers('openTrades')">OPEN</th>
                  <th onclick="sortUsers('closedTrades')">CLOSED</th>
                  <th>WIN RATE</th>
                  <th onclick="sortUsers('totalPnl')">NET P&L</th>
                  <th onclick="sortUsers('createdAt')">JOINED</th>
                  <th>ACTIONS</th>
                </tr>
              </thead>
              <tbody id="users-tbody">
                <tr><td colspan="10"><div class="loader"><div class="spinner"></div> Loading usersâ€¦</div></td></tr>
              </tbody>
            </table>
          </div>
          <div class="pagination" id="users-pagination"></div>
        </div>
      </div>

      <!-- â”€â”€ TRADES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
      <div id="page-trades" class="page">
        <div class="page-header">
          <div>
            <div class="page-title">ALL TRADES</div>
            <div class="page-sub" id="trades-sub">Platform-wide trade activity</div>
          </div>
          <button class="btn btn-outline-gold" onclick="loadTrades(tradesPage)">â†» REFRESH</button>
        </div>

        <div class="toolbar">
          <select class="filter-select" id="trades-status" onchange="loadTrades(1)">
            <option value="all">All Status</option>
            <option value="open">Open Only</option>
            <option value="closed">Closed Only</option>
          </select>
        </div>

        <div class="card">
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>USER</th>
                  <th>TYPE</th>
                  <th>LOTS</th>
                  <th>OPEN PRICE</th>
                  <th>CLOSE PRICE</th>
                  <th>SL / TP</th>
                  <th>STATUS</th>
                  <th>P&L</th>
                  <th>OPENED</th>
                  <th>REASON</th>
                </tr>
              </thead>
              <tbody id="trades-tbody">
                <tr><td colspan="10"><div class="loader"><div class="spinner"></div> Loading tradesâ€¦</div></td></tr>
              </tbody>
            </table>
          </div>
          <div class="pagination" id="trades-pagination"></div>
        </div>
      </div>

      <!-- â”€â”€ MARKET â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
      <div id="page-market" class="page">
        <div class="page-header">
          <div>
            <div class="page-title">XAU/USD LIVE MARKET</div>
            <div class="page-sub">Real-time price data Â· Auto-refresh every 2s</div>
          </div>
        </div>

        <div class="stats-grid" id="market-stats">
          <div class="loader"><div class="spinner"></div></div>
        </div>

        <div class="card">
          <div class="card-header"><span class="card-title">Recent Candles (1-min)</span></div>
          <div class="card-body">
            <div class="table-wrap">
              <table>
                <thead><tr><th>TIME</th><th>OPEN</th><th>HIGH</th><th>LOW</th><th>CLOSE</th><th>DIRECTION</th></tr></thead>
                <tbody id="candles-tbody"></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

    </div><!-- /content -->
  </div><!-- /layout -->
</div><!-- /app -->

<!-- â”€â”€ USER DETAIL MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div id="user-modal" style="display:none">
  <div class="modal-backdrop" onclick="if(event.target===this)closeModal()">
    <div class="modal">
      <div class="modal-header">
        <span class="modal-title" id="modal-title">USER DETAIL</span>
        <button class="modal-close" onclick="closeModal()">âœ•</button>
      </div>
      <div class="modal-body" id="modal-body">
        <div class="loader"><div class="spinner"></div></div>
      </div>
    </div>
  </div>
</div>

<!-- â”€â”€ TOAST CONTAINER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div id="toast-container"></div>

<script>
'use strict';

// â”€â”€ Config â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const API =  'https://aurumtrader.onrender.com/api/v1';
let adminKey = '';
let usersPage = 1;
let tradesPage = 1;
let userSortDir = 'desc';
let dashInterval, priceInterval, marketInterval;

// â”€â”€ Auth â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function doLogin() {
  const pass = document.getElementById('admin-pass').value.trim();
  if (!pass) return;
  const btn = document.getElementById('login-btn');
  btn.disabled = true; btn.textContent = 'AUTHENTICATINGâ€¦';
  const err = document.getElementById('login-error');
  err.style.display = 'none';

  try {
    const res = await fetch(`${API}/admin/login`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ password: pass }),
    });
    const data = await res.json();
    if (!res.ok) throw new Error(data.error || 'Login failed');
    adminKey = data.token;
    showApp();
  } catch (e) {
    err.textContent = e.message;
    err.style.display = 'block';
  } finally {
    btn.disabled = false; btn.textContent = 'ACCESS PANEL';
  }
}
document.getElementById('admin-pass').addEventListener('keydown', e => {
  if (e.key === 'Enter') doLogin();
});

function showApp() {
  document.getElementById('login-screen').style.display = 'none';
  document.getElementById('app').style.display = 'flex';
  loadDashboard();
  startPricePolling();
  dashInterval = setInterval(loadDashboard, 10000);
}

function logout() {
  clearInterval(dashInterval);
  clearInterval(priceInterval);
  clearInterval(marketInterval);
  adminKey = '';
  document.getElementById('app').style.display = 'none';
  document.getElementById('login-screen').style.display = 'flex';
  document.getElementById('admin-pass').value = '';
}

// â”€â”€ API Helper â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function api(path, opts = {}) {
  const res = await fetch(`${API}${path}`, {
    ...opts,
    headers: {
      'Content-Type': 'application/json',
      'X-Admin-Key': adminKey,
      ...(opts.headers || {}),
    },
    body: opts.body ? JSON.stringify(opts.body) : undefined,
  });
  const data = await res.json();
  if (!res.ok) throw new Error(data.error || `HTTP ${res.status}`);
  return data;
}

// â”€â”€ Navigation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showPage(name) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.getElementById('page-' + name)?.classList.add('active');
  document.querySelector(`[data-page="${name}"]`)?.classList.add('active');

  clearInterval(marketInterval);
  if (name === 'users') loadUsers(1);
  else if (name === 'trades') loadTrades(1);
  else if (name === 'market') { loadMarket(); marketInterval = setInterval(loadMarket, 2000); }
}

// â”€â”€ Price Polling â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function startPricePolling() {
  fetchPrice();
  priceInterval = setInterval(fetchPrice, 2000);
}

let prevBid = 0;
async function fetchPrice() {
  try {
    const data = await api('/price/ticker');
    const t = data.ticker;
    const bid = t.bid, ask = t.ask;

    // Topbar
    const bidEl = document.getElementById('tb-bid');
    const askEl = document.getElementById('tb-ask');
    const chgEl = document.getElementById('tb-chg');
    bidEl.textContent = bid.toFixed(2);
    askEl.textContent = ask.toFixed(2);
    const chgPct = t.changePercent;
    chgEl.textContent = (chgPct >= 0 ? '+' : '') + chgPct.toFixed(2) + '%';
    bidEl.className = 'val ' + (bid > prevBid ? 'up' : bid < prevBid ? 'down' : 'neutral');
    chgEl.className = 'val ' + (chgPct >= 0 ? 'up' : 'down');

    // Dashboard banner
    setText('main-bid', bid.toFixed(2));
    setText('main-ask', ask.toFixed(2));
    setText('main-spread', t.spread.toFixed(2));
    setText('main-high', t.high24h.toFixed(2));
    setText('main-low', t.low24h.toFixed(2));
    const chgEl2 = document.getElementById('main-chg');
    if (chgEl2) {
      chgEl2.textContent = (t.change >= 0 ? '+' : '') + t.change.toFixed(2);
      chgEl2.style.color = t.change >= 0 ? 'var(--green)' : 'var(--red)';
    }
    const ts = document.getElementById('price-ts');
    if (ts) ts.textContent = new Date().toLocaleTimeString();

    document.getElementById('conn-dot').className = 'connected';
    prevBid = bid;
  } catch {
    document.getElementById('conn-dot').className = 'error';
  }
}

function setText(id, val) {
  const el = document.getElementById(id);
  if (el) el.textContent = val;
}

// â”€â”€ Dashboard â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadDashboard() {
  try {
    const data = await api('/admin/stats');
    const s = data.stats;

    document.getElementById('users-badge').textContent = s.totalUsers;
    document.getElementById('trades-badge').textContent = s.totalOpenTrades;

    document.getElementById('dash-stats').innerHTML = `
      ${statCard('TOTAL USERS', s.totalUsers, 'New today: ' + s.newUsersToday, 'gold', 'ðŸ‘¥')}
      ${statCard('TOTAL BALANCE', '$' + fmt(s.totalBalance), 'Across all accounts', 'green', 'ðŸ’°')}
      ${statCard('OPEN TRADES', s.totalOpenTrades, 'Currently live', 'blue', 'ðŸ“ˆ')}
      ${statCard('CLOSED TRADES', s.totalClosedTrades, 'All time', '', 'ðŸ“‹')}
      ${statCard('PLATFORM P&L', (s.totalPnl >= 0 ? '+' : '') + '$' + fmt(s.totalPnl), 'Net across all users', s.totalPnl >= 0 ? 'green' : 'red', 'âš¡')}
      ${statCard('TOTAL VOLUME', s.totalVolume.toFixed(2) + ' lots', 'XAU/USD traded', 'gold', 'ðŸ“Š')}
    `;

    // Recent users
    const usersData = await api('/admin/users?limit=6&sortBy=createdAt&order=desc');
    const recentHtml = usersData.users.length === 0
      ? '<div class="empty"><div class="icon">ðŸ‘¤</div>No users yet</div>'
      : `<table style="width:100%;border-collapse:collapse;font-size:12px">
          <thead><tr>
            <th style="padding:8px 14px;text-align:left;font-size:9px;letter-spacing:2px;color:var(--text-dim);border-bottom:1px solid var(--border)">USER</th>
            <th style="padding:8px 14px;text-align:right;font-size:9px;letter-spacing:2px;color:var(--text-dim);border-bottom:1px solid var(--border)">BALANCE</th>
            <th style="padding:8px 14px;text-align:center;font-size:9px;letter-spacing:2px;color:var(--text-dim);border-bottom:1px solid var(--border)">JOINED</th>
          </tr></thead>
          <tbody>
          ${usersData.users.map(u => `
            <tr style="border-bottom:1px solid var(--border);cursor:pointer" onclick="openUserModal('${u.id}')">
              <td style="padding:9px 14px">
                <div style="font-weight:700">${escHtml(u.fullName)}</div>
                <div style="color:var(--text-dim);font-size:11px">${escHtml(u.email)}</div>
              </td>
              <td style="padding:9px 14px;text-align:right;font-family:var(--font-mono)">$${fmt(u.balance)}</td>
              <td style="padding:9px 14px;text-align:center;color:var(--text-dim)">${relTime(u.createdAt)}</td>
            </tr>`).join('')}
          </tbody>
        </table>`;
    document.getElementById('recent-users').innerHTML = recentHtml;

    // Open trades
    const tradesData = await api('/admin/trades?status=open&limit=6');
    const openHtml = tradesData.trades.length === 0
      ? '<div class="empty"><div class="icon">ðŸ“ˆ</div>No open positions</div>'
      : `<table style="width:100%;border-collapse:collapse;font-size:12px">
          <thead><tr>
            <th style="padding:8px 14px;text-align:left;font-size:9px;letter-spacing:2px;color:var(--text-dim);border-bottom:1px solid var(--border)">USER</th>
            <th style="padding:8px 14px;font-size:9px;letter-spacing:2px;color:var(--text-dim);border-bottom:1px solid var(--border)">TYPE</th>
            <th style="padding:8px 14px;text-align:right;font-size:9px;letter-spacing:2px;color:var(--text-dim);border-bottom:1px solid var(--border)">LIVE P&L</th>
          </tr></thead>
          <tbody>
          ${tradesData.trades.map(t => `
            <tr style="border-bottom:1px solid var(--border)">
              <td style="padding:9px 14px">
                <div style="font-weight:700">${escHtml(t.userName)}</div>
                <div style="color:var(--text-dim);font-size:11px;font-family:var(--font-mono)">${t.openPrice.toFixed(2)} Â· ${t.lotSize}L</div>
              </td>
              <td style="padding:9px 14px">
                <span class="badge ${t.type === 'buy' ? 'badge-green' : 'badge-red'}">${t.type.toUpperCase()}</span>
              </td>
              <td style="padding:9px 14px;text-align:right;font-family:var(--font-mono);${t.livePnl >= 0 ? 'color:var(--green)' : 'color:var(--red)'}">
                ${t.livePnl >= 0 ? '+' : ''}$${fmt(t.livePnl)}
              </td>
            </tr>`).join('')}
          </tbody>
        </table>`;
    document.getElementById('dash-open-trades').innerHTML = openHtml;

  } catch (e) {
    toast('Failed to load dashboard: ' + e.message, 'error');
  }
}

function statCard(label, value, sub, color, icon) {
  return `<div class="stat-card ${color}">
    <div class="stat-icon">${icon}</div>
    <div class="label">${label}</div>
    <div class="value">${value}</div>
    <div class="sub">${sub}</div>
  </div>`;
}

// â”€â”€ Users Page â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let userSearchTimer;
function onUserSearch() {
  clearTimeout(userSearchTimer);
  userSearchTimer = setTimeout(() => loadUsers(1), 400);
}

function sortUsers(col) {
  document.getElementById('user-sort').value = col;
  loadUsers(1);
}

async function loadUsers(page = 1) {
  usersPage = page;
  const search = document.getElementById('user-search')?.value || '';
  const sortBy = document.getElementById('user-sort')?.value || 'createdAt';
  const order = sortBy === 'fullName' ? 'asc' : 'desc';

  document.getElementById('users-tbody').innerHTML = `<tr><td colspan="10"><div class="loader"><div class="spinner"></div> Loadingâ€¦</div></td></tr>`;

  try {
    const data = await api(`/admin/users?page=${page}&limit=20&search=${encodeURIComponent(search)}&sortBy=${sortBy}&order=${order}`);
    document.getElementById('users-sub').textContent = `${data.total} registered accounts`;
    document.getElementById('users-badge').textContent = data.total;

    if (data.users.length === 0) {
      document.getElementById('users-tbody').innerHTML = `<tr><td colspan="10"><div class="empty"><div class="icon">ðŸ‘¤</div>No users found</div></td></tr>`;
    } else {
      document.getElementById('users-tbody').innerHTML = data.users.map(u => `
        <tr>
          <td>
            <div style="font-weight:700;cursor:pointer;color:var(--gold)" onclick="openUserModal('${u.id}')">${escHtml(u.fullName)}</div>
            <div style="color:var(--text-dim);font-size:11px">${escHtml(u.email)}</div>
          </td>
          <td class="mono">$${fmt(u.balance)}</td>
          <td class="mono ${u.livePnl >= 0 ? 'pos' : 'neg'}">$${fmt(u.equity)}</td>
          <td class="mono ${u.livePnl >= 0 ? 'pos' : 'neg'}">${u.livePnl >= 0 ? '+' : ''}$${fmt(u.livePnl)}</td>
          <td class="td-center"><span class="badge ${u.openTrades > 0 ? 'badge-green' : 'badge-gray'}">${u.openTrades}</span></td>
          <td class="td-center">${u.closedTrades}</td>
          <td>
            <div>${u.winRate}%</div>
            <div class="wr-bar"><div class="wr-fill" style="width:${u.winRate}%"></div></div>
          </td>
          <td class="mono ${u.totalPnl >= 0 ? 'pos' : 'neg'}">${u.totalPnl >= 0 ? '+' : ''}$${fmt(u.totalPnl)}</td>
          <td style="color:var(--text-dim);font-size:11px">${fmtDate(u.createdAt)}</td>
          <td>
            <div style="display:flex;gap:6px">
              <button class="btn btn-sm btn-outline-gold" onclick="openUserModal('${u.id}')">VIEW</button>
              <button class="btn btn-sm btn-outline-red" onclick="confirmDelete('${u.id}','${escHtml(u.fullName)}')">DEL</button>
            </div>
          </td>
        </tr>`).join('');
    }

    renderPagination('users-pagination', page, data.pages, data.total, 20, p => loadUsers(p));
  } catch (e) {
    document.getElementById('users-tbody').innerHTML = `<tr><td colspan="10" style="color:var(--red);padding:20px;text-align:center">${e.message}</td></tr>`;
  }
}

// â”€â”€ Trades Page â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadTrades(page = 1) {
  tradesPage = page;
  const status = document.getElementById('trades-status')?.value || 'all';
  document.getElementById('trades-tbody').innerHTML = `<tr><td colspan="10"><div class="loader"><div class="spinner"></div> Loadingâ€¦</div></td></tr>`;

  try {
    const data = await api(`/admin/trades?page=${page}&limit=50&status=${status}`);
    document.getElementById('trades-sub').textContent = `${data.total} trades total`;
    document.getElementById('trades-badge').textContent = data.trades.filter(t => t.status === 'open').length;

    if (data.trades.length === 0) {
      document.getElementById('trades-tbody').innerHTML = `<tr><td colspan="10"><div class="empty"><div class="icon">ðŸ“ˆ</div>No trades found</div></td></tr>`;
    } else {
      document.getElementById('trades-tbody').innerHTML = data.trades.map(t => {
        const pnl = t.status === 'open' ? t.livePnl : t.pnl;
        const pnlStr = pnl !== null ? ((pnl >= 0 ? '+' : '') + '$' + fmt(pnl)) : 'â€”';
        const pnlCls = pnl !== null ? (pnl >= 0 ? 'pos' : 'neg') : '';
        return `<tr>
          <td>
            <div style="font-weight:600">${escHtml(t.userName)}</div>
            <div style="color:var(--text-dim);font-size:11px">${escHtml(t.userEmail)}</div>
          </td>
          <td><span class="badge ${t.type === 'buy' ? 'badge-green' : 'badge-red'}">${t.type.toUpperCase()}</span></td>
          <td class="mono">${t.lotSize}</td>
          <td class="mono">${t.openPrice.toFixed(2)}</td>
          <td class="mono">${t.closePrice ? t.closePrice.toFixed(2) : 'â€”'}</td>
          <td style="color:var(--text-dim);font-size:11px;font-family:var(--font-mono)">
            ${t.stopLoss ? '<span style="color:var(--red)">SL ' + t.stopLoss.toFixed(2) + '</span>' : ''}
            ${t.stopLoss && t.takeProfit ? ' / ' : ''}
            ${t.takeProfit ? '<span style="color:var(--green)">TP ' + t.takeProfit.toFixed(2) + '</span>' : ''}
            ${!t.stopLoss && !t.takeProfit ? 'â€”' : ''}
          </td>
          <td><span class="badge ${t.status === 'open' ? 'badge-green' : 'badge-gray'}">${t.status.toUpperCase()}</span></td>
          <td class="mono ${pnlCls}">${pnlStr}</td>
          <td style="color:var(--text-dim);font-size:11px">${fmtDate(t.openTime)}</td>
          <td style="color:var(--text-dim);font-size:11px">${t.closeReason ? t.closeReason.replace('_', ' ') : 'â€”'}</td>
        </tr>`;
      }).join('');
    }

    renderPagination('trades-pagination', page, data.pages, data.total, 50, p => loadTrades(p));
  } catch (e) {
    document.getElementById('trades-tbody').innerHTML = `<tr><td colspan="10" style="color:var(--red);padding:20px;text-align:center">${e.message}</td></tr>`;
  }
}

// â”€â”€ Market Page â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadMarket() {
  try {
    const snap = await api('/price/snapshot?limit=20');
    const t = snap.ticker;
    const candles = snap.candles.slice(-20).reverse();

    document.getElementById('market-stats').innerHTML = `
      ${statCard('BID', t.bid.toFixed(2), 'Current buy price', 'gold', 'ðŸ“‰')}
      ${statCard('ASK', t.ask.toFixed(2), 'Current sell price', 'gold', 'ðŸ“ˆ')}
      ${statCard('SPREAD', t.spread.toFixed(2), 'Points', '', 'â†”')}
      ${statCard('24H HIGH', t.high24h.toFixed(2), 'Session high', 'green', 'â–²')}
      ${statCard('24H LOW', t.low24h.toFixed(2), 'Session low', 'red', 'â–¼')}
      ${statCard('CHANGE', (t.change >= 0 ? '+' : '') + t.change.toFixed(2), t.changePercent.toFixed(2) + '%', t.change >= 0 ? 'green' : 'red', 'âš¡')}
    `;

    document.getElementById('candles-tbody').innerHTML = candles.map(c => {
      const isBull = c.close >= c.open;
      const pct = ((c.close - c.open) / c.open * 100).toFixed(2);
      return `<tr>
        <td class="mono" style="color:var(--text-dim)">${new Date(c.time).toLocaleTimeString()}</td>
        <td class="mono">${c.open.toFixed(2)}</td>
        <td class="mono pos">${c.high.toFixed(2)}</td>
        <td class="mono neg">${c.low.toFixed(2)}</td>
        <td class="mono ${isBull ? 'pos' : 'neg'}" style="font-weight:700">${c.close.toFixed(2)}</td>
        <td>
          <span class="badge ${isBull ? 'badge-green' : 'badge-red'}">
            ${isBull ? 'â–²' : 'â–¼'} ${Math.abs(pct)}%
          </span>
        </td>
      </tr>`;
    }).join('');
  } catch (e) {
    document.getElementById('market-stats').innerHTML = `<div style="color:var(--red);padding:20px">${e.message}</div>`;
  }
}

// â”€â”€ User Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function openUserModal(userId) {
  document.getElementById('user-modal').style.display = 'flex';
  document.getElementById('modal-title').textContent = 'LOADING USERâ€¦';
  document.getElementById('modal-body').innerHTML = '<div class="loader"><div class="spinner"></div></div>';

  try {
    const data = await api(`/admin/users/${userId}`);
    const u = data.user;
    const s = data.stats;
    const initials = u.fullName.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2);

    document.getElementById('modal-title').textContent = 'USER DETAIL';
    document.getElementById('modal-body').innerHTML = `
      <div class="user-meta">
        <div class="user-avatar">${initials}</div>
        <div class="user-info">
          <div class="name">${escHtml(u.fullName)}</div>
          <div class="email">${escHtml(u.email)}</div>
          <div class="joined">Joined ${fmtDate(u.createdAt)} Â· ${u.accountType} Account</div>
        </div>
        <div style="margin-left:auto;display:flex;flex-direction:column;gap:6px">
          <button class="btn btn-sm btn-outline-red" onclick="confirmDelete('${u.id}','${escHtml(u.fullName)}')">DELETE USER</button>
          <button class="btn btn-sm btn-outline-blue" onclick="confirmCloseAll('${u.id}','${escHtml(u.fullName)}',${data.openTrades.length})">CLOSE ALL TRADES</button>
        </div>
      </div>

      <div class="user-stats-grid">
        <div class="user-stat"><div class="label">BALANCE</div><div class="val" style="color:var(--gold)">$${fmt(u.balance)}</div></div>
        <div class="user-stat"><div class="label">EQUITY</div><div class="val ${u.livePnl >= 0 ? 'pos' : 'neg'}">$${fmt(u.equity)}</div></div>
        <div class="user-stat"><div class="label">LIVE P&L</div><div class="val ${u.livePnl >= 0 ? 'pos' : 'neg'}">${u.livePnl >= 0 ? '+' : ''}$${fmt(u.livePnl)}</div></div>
        <div class="user-stat"><div class="label">NET P&L</div><div class="val ${s.totalPnl >= 0 ? 'pos' : 'neg'}">${s.totalPnl >= 0 ? '+' : ''}$${fmt(s.totalPnl)}</div></div>
        <div class="user-stat"><div class="label">WIN RATE</div><div class="val" style="color:${s.winRate >= 50 ? 'var(--green)' : 'var(--red)'}">${s.winRate}%</div></div>
        <div class="user-stat"><div class="label">TRADES</div><div class="val">${s.openTrades} open / ${s.closedTrades} closed</div></div>
      </div>

      <div class="modal-section-title">ADJUST BALANCE</div>
      <div class="balance-edit">
        <input type="number" id="new-balance" value="${u.balance.toFixed(2)}" min="0" max="10000000" step="100" placeholder="New balance" />
        <button class="btn btn-outline-gold" onclick="adjustBalance('${u.id}')">UPDATE BALANCE</button>
      </div>

      ${data.openTrades.length > 0 ? `
      <div class="modal-section-title">OPEN POSITIONS (${data.openTrades.length})</div>
      <div class="table-wrap">
        <table>
          <thead><tr>
            <th>TYPE</th><th>LOTS</th><th>OPEN PRICE</th><th>CURRENT</th><th>SL/TP</th><th>LIVE P&L</th><th>OPENED</th>
          </tr></thead>
          <tbody>
          ${data.openTrades.map(t => `
            <tr>
              <td><span class="badge ${t.type === 'buy' ? 'badge-green' : 'badge-red'}">${t.type.toUpperCase()}</span></td>
              <td class="mono">${t.lotSize}</td>
              <td class="mono">${t.openPrice.toFixed(2)}</td>
              <td class="mono">${t.currentPrice ? t.currentPrice.toFixed(2) : 'â€”'}</td>
              <td style="font-size:11px;font-family:var(--font-mono)">
                ${t.stopLoss ? '<span style="color:var(--red)">' + t.stopLoss.toFixed(2) + '</span>' : 'â€”'}
                /
                ${t.takeProfit ? '<span style="color:var(--green)">' + t.takeProfit.toFixed(2) + '</span>' : 'â€”'}
              </td>
              <td class="mono ${t.livePnl >= 0 ? 'pos' : 'neg'}">${t.livePnl >= 0 ? '+' : ''}$${fmt(t.livePnl)}</td>
              <td style="color:var(--text-dim);font-size:11px">${relTime(t.openTime)}</td>
            </tr>`).join('')}
          </tbody>
        </table>
      </div>` : ''}

      ${data.closedTrades.length > 0 ? `
      <div class="modal-section-title">RECENT CLOSED TRADES (last ${Math.min(data.closedTrades.length, 50)})</div>
      <div class="table-wrap">
        <table>
          <thead><tr>
            <th>TYPE</th><th>LOTS</th><th>OPEN</th><th>CLOSE</th><th>P&L</th><th>REASON</th><th>CLOSED</th>
          </tr></thead>
          <tbody>
          ${data.closedTrades.slice(0, 20).map(t => `
            <tr>
              <td><span class="badge ${t.type === 'buy' ? 'badge-green' : 'badge-red'}">${t.type.toUpperCase()}</span></td>
              <td class="mono">${t.lotSize}</td>
              <td class="mono">${t.openPrice.toFixed(2)}</td>
              <td class="mono">${t.closePrice ? t.closePrice.toFixed(2) : 'â€”'}</td>
              <td class="mono ${(t.pnl || 0) >= 0 ? 'pos' : 'neg'}">${(t.pnl || 0) >= 0 ? '+' : ''}$${fmt(t.pnl || 0)}</td>
              <td><span class="badge badge-gray" style="font-size:9px">${(t.closeReason || 'â€”').replace('_',' ')}</span></td>
              <td style="color:var(--text-dim);font-size:11px">${t.closeTime ? fmtDate(t.closeTime) : 'â€”'}</td>
            </tr>`).join('')}
          </tbody>
        </table>
      </div>` : ''}
    `;
  } catch (e) {
    document.getElementById('modal-body').innerHTML = `<div style="color:var(--red);padding:20px">${e.message}</div>`;
  }
}

function closeModal() {
  document.getElementById('user-modal').style.display = 'none';
}

// â”€â”€ Admin Actions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function adjustBalance(userId) {
  const val = parseFloat(document.getElementById('new-balance').value);
  if (isNaN(val) || val < 0) { toast('Invalid balance amount', 'error'); return; }
  try {
    const data = await api(`/admin/users/${userId}/balance`, { method: 'PATCH', body: { balance: val } });
    toast('Balance updated to $' + fmt(data.balance), 'success');
    openUserModal(userId); // Reload modal
    if (document.getElementById('page-users').classList.contains('active')) loadUsers(usersPage);
  } catch (e) {
    toast('Error: ' + e.message, 'error');
  }
}

async function confirmDelete(userId, name) {
  if (!confirm(`âš ï¸ DELETE USER "${name}"?\n\nThis will permanently delete the user and ALL their trade history. This cannot be undone.`)) return;
  try {
    await api(`/admin/users/${userId}`, { method: 'DELETE' });
    toast(`User "${name}" deleted.`, 'success');
    closeModal();
    if (document.getElementById('page-users').classList.contains('active')) loadUsers(usersPage);
    loadDashboard();
  } catch (e) {
    toast('Error: ' + e.message, 'error');
  }
}

async function confirmCloseAll(userId, name, count) {
  if (count === 0) { toast('No open trades to close', 'error'); return; }
  if (!confirm(`Force close all ${count} open trade(s) for "${name}"?\n\nThis will close positions at current market price.`)) return;
  try {
    const data = await api(`/admin/users/${userId}/close-all`, { method: 'POST' });
    toast(`Closed ${data.closed} trade(s). Net P&L: ${data.totalPnl >= 0 ? '+' : ''}$${fmt(data.totalPnl)}`, 'success');
    openUserModal(userId);
  } catch (e) {
    toast('Error: ' + e.message, 'error');
  }
}

// â”€â”€ Pagination â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderPagination(containerId, current, total, count, limit, cb) {
  const container = document.getElementById(containerId);
  if (!container) return;
  const start = (current - 1) * limit + 1;
  const end = Math.min(current * limit, count);
  let html = `<span class="info">Showing ${start}â€“${end} of ${count}</span>`;
  html += `<button class="pg-btn" onclick="(${cb})(${current - 1})" ${current <= 1 ? 'disabled' : ''}>â† PREV</button>`;

  const pages = Math.min(total, 7);
  let startP = Math.max(1, current - 3);
  let endP = Math.min(total, startP + pages - 1);
  startP = Math.max(1, endP - pages + 1);

  for (let p = startP; p <= endP; p++) {
    html += `<button class="pg-btn ${p === current ? 'active' : ''}" onclick="(${cb})(${p})">${p}</button>`;
  }

  html += `<button class="pg-btn" onclick="(${cb})(${current + 1})" ${current >= total ? 'disabled' : ''}>NEXT â†’</button>`;
  container.innerHTML = html;
}

// â”€â”€ Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toast(msg, type = '') {
  const el = document.createElement('div');
  el.className = `toast ${type}`;
  el.textContent = msg;
  document.getElementById('toast-container').appendChild(el);
  setTimeout(() => el.remove(), 3100);
}

// â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function fmt(n) {
  if (n === null || n === undefined) return '0.00';
  return Number(n).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
}

function fmtDate(ts) {
  if (!ts) return 'â€”';
  return new Date(ts).toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: '2-digit', hour: '2-digit', minute: '2-digit' });
}

function relTime(ts) {
  const diff = Date.now() - ts;
  if (diff < 60000) return Math.floor(diff / 1000) + 's ago';
  if (diff < 3600000) return Math.floor(diff / 60000) + 'm ago';
  if (diff < 86400000) return Math.floor(diff / 3600000) + 'h ago';
  return Math.floor(diff / 86400000) + 'd ago';
}

function escHtml(str) {
  return String(str).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
}
</script>
</body>
</html>
